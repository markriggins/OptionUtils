<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
    h3 { margin: 0 0 16px 0; color: #202124; }
    .description { color: #5f6368; font-size: 13px; margin-bottom: 16px; line-height: 1.5; }
    .warning { background: #fef7e0; border-left: 4px solid #f9ab00; padding: 12px; margin-bottom: 16px; font-size: 13px; }
    .buttons { margin-top: 20px; text-align: right; }
    .buttons button { padding: 10px 24px; border-radius: 4px; cursor: pointer; font-size: 14px; margin-left: 8px; }
    #cancelBtn { background: white; border: 1px solid #dadce0; color: #5f6368; }
    #cancelBtn:hover { background: #f1f3f4; }
    #initBtn { background: #1a73e8; border: none; color: white; }
    #initBtn:hover { background: #1557b0; }
    .status { margin-top: 12px; padding: 12px; border-radius: 4px; font-size: 13px; display: none; }
    .status.info { background: #e8f0fe; color: #1a73e8; display: block; }
    .status.success { background: #e6f4ea; color: #137333; display: block; }
    .status.error { background: #fce8e6; color: #c5221f; display: block; }
    .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid #1a73e8; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px; vertical-align: middle; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <h3>Initialize / Clear Project</h3>

  <div class="description">
    This will clear all sheets except README and remove any named ranges.
  </div>

  <div id="sheetsWarning" class="warning" style="display:none;">
    <strong>Sheets to delete:</strong>
    <div id="sheetsList" style="margin-top: 8px; white-space: pre-line;"></div>
  </div>

  <div id="noSheetsMsg" class="description" style="display:none;">
    No sheets to delete.
  </div>

  <div id="status" class="status"></div>

  <div class="buttons">
    <button id="cancelBtn" onclick="google.script.host.close()">Cancel</button>
    <button id="initBtn" onclick="doInitialize()">Initialize</button>
  </div>

  <script>
    function init(data) {
      if (data.sheetsToDelete && data.sheetsToDelete.length > 0) {
        document.getElementById('sheetsWarning').style.display = 'block';
        document.getElementById('sheetsList').innerText = data.sheetsToDelete.map(function(s) { return '  \u2022 ' + s; }).join('\n');
      } else {
        document.getElementById('noSheetsMsg').style.display = 'block';
      }
    }

    function showStatus(message, type) {
      var el = document.getElementById('status');
      el.className = 'status ' + type;
      el.innerHTML = message;
    }

    function doInitialize() {
      document.getElementById('initBtn').disabled = true;
      showStatus('<span class="spinner"></span>Initializing...', 'info');

      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onError)
        .completeInitialization();
    }

    function onSuccess(result) {
      showStatus(result || 'Project initialized successfully!', 'success');
      document.getElementById('initBtn').innerText = 'Done';
      document.getElementById('initBtn').disabled = false;
      document.getElementById('initBtn').onclick = function() { google.script.host.close(); };
    }

    function onError(err) {
      showStatus('Error: ' + (err.message || err), 'error');
      document.getElementById('initBtn').disabled = false;
    }
  </script>
</body>
</html>
